# Домашнє завдання 4

Створи гілку `04-auth` з гілки `master`.
Продовж створення REST API для роботи з колекцією контактів. Додай логіку аутентифікації / авторизації користувача через `JWT`.

## Крок 1

У коді створи схему і модель користувача для колекції `users`.
Змініть схему контактів, щоб кожен користувач бачив тільки свої контакти. Для цього в схемі контактів додайте властивість

```js
   owner: {
      type: Schema.Types.ObjectId,
      ref: 'user',
    }
```

`user` - назва колекції, у якій зберігаються користувачі.

## Крок 2

### Реєстрація

Створити ендпоінт `/users/register`
Зробити валідацію всіх обов'язкових полів (email і password). При помилці валідації повернути Помилку валідації.
У разі успішної валідації в моделі `User` створити користувача за даними, які пройшли валідацію. Для засолювання паролів використовуй `bcrypt` або `bcryptjs`.
Якщо пошта вже використовується кимось іншим, повернути `Помилку Conflict`.
В іншому випадку повернути `Успішна відповідь`.

### Логін

Створити ендпоінт `/users/login`
В моделі `User` знайти користувача за `email`.
Зробити валідацію всіх обов'язкових полів (email і password). При помилці валідації повернути `Помилку валідації`.
В іншому випадку, порівняти пароль для знайденого користувача, якщо паролі збігаються створити токен, зберегти в поточному юзера і повернути `Успішна відповідь`.
Якщо пароль або імейл невірний, повернути `Помилку Unauthorized`.

## Крок 3

### Перевірка токена

Створи мідлвар для перевірки токена і додай його до всіх раутів, які повинні бути захищені.
Мідлвар бере токен з заголовків `Authorization`, перевіряє токен на валідність.
У випадку помилки повернути `Помилку Unauthorized`.
Якщо валідація пройшла успішно, отримати з токена `id` користувача. Знайти користувача в базі даних з цим `id`.
Якщо користувач існує і токен збігається з тим, що знаходиться в базі, записати його дані в `req.user` і викликати `next()`.
Якщо користувача з таким `id` НЕ існує або токени не збігаються, повернути `Помилку Unauthorized`.

## Крок 4

### Логаут

Створити ендпоінт `/users/logout`.
Додай в маршрут мідлвар перевірки токена.
У моделі `User` знайти користувача за `_id`.
Якщо користувача не існує повернути `Помилку Unauthorized`.
В іншому випадку, видалити токен у поточного юзера і повернути `Успішна відповідь`.

## Крок 5

### Поточний користувач

Отримати дані юзера по токені.
Створити ендпоінт `/users/current`.
Додай в раут мідлвар перевірки токена.
Якщо користувача не існує повернути `Помилку Unauthorized`.
В іншому випадку повернути `Успішну відповідь`.

## Додаткове завдання

Зробити пагінацію для колекції контактів `(GET /contacts?page=1&limit=20)`.
Зробити фільтрацію контактів по полю обраного `(GET /contacts?favorite=true)`.
Оновлення підписки `(subscription)` користувача через ендпоінт `PATCH /users`. Підписка повинна мати одне з наступних значень `['starter', 'pro', 'business']`.
